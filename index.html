<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Sorry I Can't Make It, Nima & Elien</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:             #0C0B0A;
            --text-primary:   #F5F0EB;
            --text-secondary: #8C8580;
            --accent:         #C4846E;
            --accent-dim:     rgba(196, 132, 110, 0.12);
            --hairline:       rgba(255, 255, 255, 0.07);
            --ease:           cubic-bezier(0.25, 0.1, 0.25, 1);
            --ease-out:       cubic-bezier(0.0, 0.0, 0.2, 1);
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html {
            font-size: 17px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* ══════════════════════════════════════
           CANVAS layers
        ══════════════════════════════════════ */
        #particle-canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        #confetti-canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 200;
        }

        /* ══════════════════════════════════════
           INTRO SCENE
        ══════════════════════════════════════ */
        .intro-spacer {
            height: 400vh;
            position: relative;
        }

        .intro {
            position: sticky;
            top: 0;
            height: 100vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            z-index: 10;
            --p: 0;
        }

        /* Black fade-out curtain — JS sets opacity directly */
        .intro-curtain {
            position: absolute;
            inset: 0;
            background: var(--bg);
            opacity: 0;
            pointer-events: none;
            z-index: 20;
        }

        /* ── "For" label ── */
        .intro-for {
            position: absolute;
            top: clamp(32px, 6vh, 64px);
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            color: var(--accent);
            white-space: nowrap;
            z-index: 15;
            display: flex;
            align-items: center;
            gap: 14px;
            will-change: opacity;
        }

        .intro-for::before, .intro-for::after {
            content: '';
            display: block;
            width: 32px;
            height: 1px;
            background: var(--accent);
            opacity: 0.4;
        }

        /* ── Name rows ── */
        .intro-names {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            z-index: 15;
            position: relative;
        }

        .intro-name-row {
            overflow: hidden;
            line-height: 0.88;
        }

        .intro-name {
            display: block;
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-weight: 700;
            font-size: clamp(22vw, 26vw, 28vw);
            letter-spacing: -0.04em;
            line-height: 0.88;
            color: var(--text-primary);
            will-change: transform, filter;
            position: relative;
        }

        /* NIMA — JS drives transforms directly via style attribute */
        .intro-name--nima {
            transform-origin: center bottom;
            will-change: transform, filter;
        }

        /* RGB split ghost layers — JS sets their translateX */
        .intro-name--nima::before,
        .intro-name--nima::after {
            content: attr(data-text);
            position: absolute;
            inset: 0;
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            letter-spacing: inherit;
            line-height: inherit;
            pointer-events: none;
            will-change: transform;
        }

        .intro-name--nima::before {
            color: rgba(255, 80, 80, 0.55);
            mix-blend-mode: screen;
            transform: translateX(var(--rx, 0px));
        }

        .intro-name--nima::after {
            color: rgba(80, 180, 255, 0.55);
            mix-blend-mode: screen;
            transform: translateX(var(--bx, 0px));
        }

        /* ELIEN — JS drives transforms */
        .intro-name--elien {
            transform-origin: center top;
            will-change: transform, filter;
        }

        .intro-name--elien::before,
        .intro-name--elien::after {
            content: attr(data-text);
            position: absolute;
            inset: 0;
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            letter-spacing: inherit;
            line-height: inherit;
            pointer-events: none;
            will-change: transform;
        }

        .intro-name--elien::before {
            color: rgba(255, 80, 80, 0.45);
            mix-blend-mode: screen;
            transform: translateX(var(--rx, 0px));
        }

        .intro-name--elien::after {
            color: rgba(80, 180, 255, 0.45);
            mix-blend-mode: screen;
            transform: translateX(var(--bx, 0px));
        }

        /* ── & connector — JS sets opacity/transform ── */
        .intro-amp-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 4px 0;
            will-change: opacity, transform;
            z-index: 15;
        }

        .intro-amp {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: clamp(6vw, 8vw, 7rem);
            font-weight: 400;
            font-style: italic;
            color: var(--accent);
            line-height: 1;
            text-shadow:
                0 0 40px rgba(196, 132, 110, 0.6),
                0 0 80px rgba(196, 132, 110, 0.3),
                0 0 160px rgba(196, 132, 110, 0.15);
            animation: amppulse 2.4s ease-in-out infinite;
        }

        @keyframes amppulse {
            0%, 100% { text-shadow: 0 0 40px rgba(196,132,110,0.6), 0 0 80px rgba(196,132,110,0.3); }
            50%       { text-shadow: 0 0 60px rgba(196,132,110,0.9), 0 0 120px rgba(196,132,110,0.5), 0 0 200px rgba(196,132,110,0.2); }
        }

        .amp-rule {
            flex: 1;
            max-width: 80px;
            height: 1px;
            background: linear-gradient(to right, transparent, var(--accent));
            opacity: 0.4;
        }

        .amp-rule:last-child {
            background: linear-gradient(to left, transparent, var(--accent));
        }

        /* ── Scroll hint ── */
        .intro-scroll-hint {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            pointer-events: none;
            z-index: 15;
            will-change: opacity;
        }

        .scroll-label {
            font-family: 'Inter', sans-serif;
            font-size: 9px;
            font-weight: 400;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--text-secondary);
        }

        .scroll-line {
            width: 1px;
            height: 36px;
            background: linear-gradient(to bottom, var(--accent), transparent);
            animation: scrollpulse 1.6s ease-in-out infinite;
        }

        @keyframes scrollpulse {
            0%, 100% { opacity: 0.25; transform: scaleY(0.8) translateY(-4px); }
            50%       { opacity: 0.9;  transform: scaleY(1.1) translateY(4px); }
        }

        /* ══════════════════════════════════════
           NOISE OVERLAY
        ══════════════════════════════════════ */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
            z-index: 9999;
        }

        /* ══════════════════════════════════════
           PAGE CONTENT
        ══════════════════════════════════════ */
        .page {
            max-width: 760px;
            margin: 0 auto;
            padding: 112px 40px 140px;
            position: relative;
            z-index: 1;
        }

        header {
            margin-bottom: 128px;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.9s var(--ease-out), transform 0.9s var(--ease-out);
        }

        header.visible { opacity: 1; transform: translateY(0); }

        .eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 28px;
        }

        .eyebrow::before {
            content: '';
            display: block;
            width: 24px;
            height: 1px;
            background: var(--accent);
            opacity: 0.6;
        }

        h1 {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: clamp(3rem, 7vw, 5rem);
            font-weight: 700;
            line-height: 1.05;
            letter-spacing: -0.025em;
            color: var(--text-primary);
            margin-bottom: 28px;
        }

        h1 em {
            font-style: italic;
            font-weight: 400;
            color: var(--accent);
        }

        .subtitle {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-secondary);
            line-height: 1.65;
            max-width: 480px;
        }

        .reasons { margin-bottom: 128px; }

        .reason {
            display: grid;
            grid-template-columns: 52px 1fr;
            gap: 0 36px;
            padding: 36px 16px;
            border-top: 1px solid var(--hairline);
            opacity: 0;
            transform: translateY(16px);
            transition: opacity 0.55s var(--ease-out), transform 0.55s var(--ease-out), background 0.2s var(--ease);
            margin: 0 -16px;
        }

        .reason:last-child { border-bottom: 1px solid var(--hairline); }
        .reason.visible    { opacity: 1; transform: translateY(0); }
        .reason:hover      { background: var(--accent-dim); }
        .reason:hover .reason-number { color: var(--text-primary); }

        .reason-number {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.12em;
            color: var(--accent);
            padding-top: 4px;
            line-height: 1.75;
            transition: color 0.2s var(--ease);
        }

        .reason-text {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-primary);
            font-weight: 300;
        }

        .section-divider {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 80px;
            opacity: 0;
            transform: translateY(12px);
            transition: opacity 0.55s var(--ease-out), transform 0.55s var(--ease-out);
        }

        .section-divider.visible { opacity: 1; transform: translateY(0); }

        .section-divider::before, .section-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--hairline);
        }

        .divider-mark {
            width: 5px; height: 5px;
            border-radius: 50%;
            background: var(--accent);
            opacity: 0.6;
        }

        .closing {
            max-width: 560px;
            margin: 0 auto;
            text-align: center;
            opacity: 0;
            transform: translateY(16px);
            transition: opacity 0.65s var(--ease-out), transform 0.65s var(--ease-out);
        }

        .closing.visible { opacity: 1; transform: translateY(0); }

        .closing h2 {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 2.4rem;
            font-weight: 400;
            font-style: italic;
            color: var(--text-primary);
            margin-bottom: 36px;
            line-height: 1.2;
        }

        .closing p {
            font-size: 1rem;
            line-height: 1.85;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-weight: 300;
        }

        .signature {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text-secondary);
            margin-top: 52px;
            line-height: 1.7;
            border-top: 1px solid var(--hairline);
            padding-top: 40px;
        }

        @keyframes fadein {
            from { opacity: 0; transform: translateY(8px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 600px) {
            .page { padding: 72px 24px 100px; }
            header { margin-bottom: 88px; }
            .reasons { margin-bottom: 88px; }
            .reason { grid-template-columns: 40px 1fr; gap: 0 20px; }
        }
    </style>
</head>
<body>

<canvas id="particle-canvas"></canvas>
<canvas id="confetti-canvas"></canvas>

<!-- ══ INTRO SCENE ══ -->
<div class="intro-spacer" id="introSpacer">
    <div class="intro" id="intro">
        <div class="intro-curtain" id="introCurtain"></div>
        <p class="intro-for" id="introFor">For</p>

        <div class="intro-names" id="introNames">
            <div class="intro-name-row">
                <span class="intro-name intro-name--nima" data-text="Nima">Nima</span>
            </div>
            <div class="intro-amp-row">
                <span class="amp-rule"></span>
                <span class="intro-amp">&amp;</span>
                <span class="amp-rule"></span>
            </div>
            <div class="intro-name-row">
                <span class="intro-name intro-name--elien" data-text="Elien">Elien</span>
            </div>
        </div>

        <div class="intro-scroll-hint" id="introScrollHint">
            <span class="scroll-label">Scroll</span>
            <div class="scroll-line"></div>
        </div>
    </div>
</div>

<!-- ══ PAGE CONTENT ══ -->
<div class="page">
    <header>
        <p class="eyebrow">A Note from Manhattan</p>
        <h1>12 Reasons I Can't Make It to Your <em>Wedding,</em> Nima&nbsp;&amp;&nbsp;Elien.</h1>
        <p class="subtitle">A marketing buddy's rigorous, data-driven analysis of why Manhattan parenthood and San Miguel de Allende are mutually exclusive.</p>
    </header>

    <div class="reasons">
        <div class="reason"><div class="reason-number">01</div><div class="reason-text">I tried to growth hack my calendar. The kids' bedtime sprint won the A/B test. It always does.</div></div>
        <div class="reason"><div class="reason-number">02</div><div class="reason-text">Manhattan to San Miguel de Allende with children isn't a trip. It's a multi-phase campaign with too many failure points and no fallback plan.</div></div>
        <div class="reason"><div class="reason-number">03</div><div class="reason-text">The CAC (Cost of Acquiring Childcare) for a destination wedding in Mexico exceeded my annual marketing budget. The LTV math isn't pretty.</div></div>
        <div class="reason"><div class="reason-number">04</div><div class="reason-text">My KPIs this quarter: diapers changed, bedtime stories read, legendary Nima parties attended. One of these has been consistently underperforming.</div></div>
        <div class="reason"><div class="reason-number">05</div><div class="reason-text">While you're scaling Pearmill, I'm scaling Mount Laundry. Different trajectories, same hustle.</div></div>
        <div class="reason"><div class="reason-number">06</div><div class="reason-text">I'm deep in a growth sprint that lasts 18 years. Per child. The backlog is extensive and the velocity is not what I projected.</div></div>
        <div class="reason"><div class="reason-number">07</div><div class="reason-text">User retention (kids) requires 24/7 on-call support. International travel violates every SLA I have committed to.</div></div>
        <div class="reason"><div class="reason-number">08</div><div class="reason-text">My retargeting strategy failed. The kids won't let me leave the apartment after 6pm, let alone the country. Bounce rate: 100%.</div></div>
        <div class="reason"><div class="reason-number">09</div><div class="reason-text">I optimized the wrong funnel. Breakfast → school drop-off → survive → pickup → collapse. Mexico doesn't fit the workflow.</div></div>
        <div class="reason"><div class="reason-number">10</div><div class="reason-text">Manhattan to Brooklyn was already hard enough. Adding an international leg to a venue as beautiful as Instituto Allende only makes the guilt more exquisite.</div></div>
        <div class="reason"><div class="reason-number">11</div><div class="reason-text">I'm running a lifetime value analysis on sleep. I am deep in the red. Adding a destination wedding would trigger a churn event I cannot recover from.</div></div>
        <div class="reason"><div class="reason-number">12</div><div class="reason-text">I A/B tested my excuses. This one had the highest conversion rate. It's a data-driven decision. I stand by it. I'm still sorry.</div></div>
    </div>

    <div class="section-divider"><div class="divider-mark"></div></div>

    <div class="closing">
        <h2>But seriously, Nima.</h2>
        <p>I'm genuinely bummed to miss your day at Instituto Allende. You throw the best parties in Brooklyn, and I know this wedding will be the most beautiful thing you've ever produced — and you've produced some great ones.</p>
        <p>I'm so happy you found Elien. Here's to your greatest campaign yet: building Pearmill and a lifetime of happiness together. I'll be thinking of you both and raising something (almost certainly a sippy cup) from Manhattan in your honor.</p>
        <div class="signature">With love and a genuine case of FOMO,<br>Your Marketing Buddy ❤️</div>
    </div>
</div>

<script>
// ══════════════════════════════════════════════════
// PARTICLE FIELD
// ══════════════════════════════════════════════════
(function () {
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');

    let W, H, particles;

    function resize() {
        W = canvas.width  = window.innerWidth;
        H = canvas.height = window.innerHeight;
    }

    function init() {
        resize();
        particles = Array.from({ length: 120 }, () => ({
            x:    Math.random() * W,
            y:    Math.random() * H,
            r:    Math.random() * 1.5 + 0.3,
            vx:   (Math.random() - 0.5) * 0.15,
            vy:   (Math.random() - 0.5) * 0.15,
            base: Math.random() * 0.35 + 0.05,
            phase: Math.random() * Math.PI * 2,
        }));
    }

    window.addEventListener('resize', resize);

    let t = 0;
    function draw() {
        ctx.clearRect(0, 0, W, H);
        t += 0.008;

        // Only show particles while intro is visible
        const spacer = document.getElementById('introSpacer');
        const p = Math.min(1, window.scrollY / Math.max(1, spacer.offsetHeight - H));
        const globalAlpha = Math.max(0, 1 - p * 1.8);

        if (globalAlpha > 0) {
            particles.forEach(pt => {
                pt.x += pt.vx;
                pt.y += pt.vy;
                if (pt.x < 0) pt.x = W;
                if (pt.x > W) pt.x = 0;
                if (pt.y < 0) pt.y = H;
                if (pt.y > H) pt.y = 0;

                const alpha = globalAlpha * (pt.base + Math.sin(t + pt.phase) * 0.15);
                ctx.beginPath();
                ctx.arc(pt.x, pt.y, pt.r, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(196, 132, 110, ${alpha})`;
                ctx.fill();
            });
        }

        requestAnimationFrame(draw);
    }

    init();
    requestAnimationFrame(draw);
})();


// ══════════════════════════════════════════════════
// SCROLL-DRIVEN INTRO — all transforms applied via JS
// (CSS calc(var(--p)) is unreliable on iOS Safari)
// ══════════════════════════════════════════════════
const spacer      = document.getElementById('introSpacer');
const intro       = document.getElementById('intro');
const curtain     = document.getElementById('introCurtain');
const introFor    = document.getElementById('introFor');
const scrollHint  = document.getElementById('introScrollHint');
const ampRow      = intro.querySelector('.intro-amp-row');
const nameNima    = intro.querySelector('.intro-name--nima');
const nameElien   = intro.querySelector('.intro-name--elien');

let confettiFired = false;

function clamp(v, lo, hi) { return Math.min(hi, Math.max(lo, v)); }
function lerp(a, b, t) { return a + (b - a) * t; }

function tick() {
    const H         = window.innerHeight;
    const maxScroll = Math.max(1, spacer.offsetHeight - H);
    const p         = clamp(window.scrollY / maxScroll, 0, 1);

    // ── NIMA: scale up and fly off top ──
    const nimaScale = 1 + p * 4;
    const nimaMoveY = p * -H * 0.25;
    const nimaBlur  = p * p * 14;
    const nimaBright = 1 + p * 0.9;
    nameNima.style.transform = `scale(${nimaScale}) translateY(${nimaMoveY}px)`;
    nameNima.style.filter    = `blur(${nimaBlur}px) brightness(${nimaBright})`;

    // RGB ghost splits via CSS vars on the element (still works since it's not in transform)
    const nimaShift = p * 10;
    nameNima.style.setProperty('--rx', `-${nimaShift}px`);
    nameNima.style.setProperty('--bx', `${nimaShift}px`);

    // ── ELIEN: scale up and fly off bottom ──
    const elienScale  = 1 + p * 3.5;
    const elienMoveY  = p * H * 0.22;
    const elienBlur   = p * p * 11;
    const elienBright = 1 + p * 0.7;
    nameElien.style.transform = `scale(${elienScale}) translateY(${elienMoveY}px)`;
    nameElien.style.filter    = `blur(${elienBlur}px) brightness(${elienBright})`;

    const elienShift = p * 8;
    nameElien.style.setProperty('--rx', `-${elienShift}px`);
    nameElien.style.setProperty('--bx', `${elienShift}px`);

    // ── & row ──
    const ampOpacity = clamp(1 - p * 5, 0, 1);
    const ampScale   = 1 - p * 0.3;
    ampRow.style.opacity   = ampOpacity;
    ampRow.style.transform = `scale(${ampScale})`;

    // ── "For" label ──
    introFor.style.opacity = clamp(1 - p * 4, 0, 1);

    // ── Scroll hint ──
    scrollHint.style.opacity = clamp(1 - p * 8, 0, 1);

    // ── Black curtain ──
    const curtainOpacity = clamp((p - 0.7) * 3.33, 0, 1);
    curtain.style.opacity = curtainOpacity;

    // ── Fire confetti at transition point ──
    if (p >= 0.68 && !confettiFired) {
        confettiFired = true;
        fireConfetti();
    }

    requestAnimationFrame(tick);
}

requestAnimationFrame(tick);


// ══════════════════════════════════════════════════
// SCROLL REVEAL
// ══════════════════════════════════════════════════
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const delay = parseInt(entry.target.dataset.delay || 0);
            setTimeout(() => entry.target.classList.add('visible'), delay);
            observer.unobserve(entry.target);
        }
    });
}, { threshold: 0.12, rootMargin: '0px 0px -32px 0px' });

document.querySelectorAll('.reason').forEach((el, i) => {
    el.dataset.delay = i * 55;
    observer.observe(el);
});

document.querySelectorAll('.closing, .section-divider, header').forEach(el => observer.observe(el));


// ══════════════════════════════════════════════════
// CONFETTI
// ══════════════════════════════════════════════════
function fireConfetti() {
    const canvas = document.getElementById('confetti-canvas');
    const ctx    = canvas.getContext('2d');
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;

    const COLORS = ['#C4846E', '#8C7060', '#D4A99A', '#F5F0EB', '#78716C', '#E8B89A'];
    const DURATION = 3200;
    const start = performance.now();

    // Mix of circles and thin rectangles for variety
    const particles = Array.from({ length: 70 }, () => {
        const angle = (Math.random() * 200 + 170) * (Math.PI / 180);
        const speed = Math.random() * 12 + 4;
        const isRect = Math.random() > 0.5;
        return {
            x:     canvas.width  / 2 + (Math.random() - 0.5) * 100,
            y:     canvas.height * 0.55,
            vx:    Math.cos(angle) * speed,
            vy:    Math.sin(angle) * speed,
            r:     Math.random() * 4 + 2,
            w:     Math.random() * 10 + 4,
            h:     Math.random() * 4 + 2,
            rot:   Math.random() * Math.PI * 2,
            rotV:  (Math.random() - 0.5) * 0.3,
            color: COLORS[Math.floor(Math.random() * COLORS.length)],
            isRect,
        };
    });

    function draw(now) {
        const elapsed = now - start;
        if (elapsed > DURATION) { ctx.clearRect(0, 0, canvas.width, canvas.height); return; }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const t = elapsed / DURATION;

        particles.forEach(p => {
            p.vy  += 0.22;
            p.vx  *= 0.993;
            p.x   += p.vx;
            p.y   += p.vy;
            p.rot += p.rotV;

            const alpha = Math.max(0, 1 - t * t * 1.4);
            ctx.globalAlpha = alpha;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot);
            ctx.fillStyle = p.color;
            if (p.isRect) {
                ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
            } else {
                ctx.beginPath();
                ctx.arc(0, 0, p.r, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.restore();
        });

        ctx.globalAlpha = 1;
        requestAnimationFrame(draw);
    }

    requestAnimationFrame(draw);
}
</script>
</body>
</html>
